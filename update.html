<!-- プロフィール更新用-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>マッチングサイト</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <script src="useNcmb.js"></script>
  <script src="https://kit.fontawesome.com/f58a0ec02b.js" crossorigin="anonymous"></script>
  <script src="./kuromoji.js"></script>
</head>

<body>
  <script src="update.js"></script>
  <div id="page">
    <div id="home"> <a href="mainPage.html" id="logo">プロフィール登録</a>
      <!-- プロフィール更新ですが、ぽすたーの関係でいったん文字を変えています -- >
      <!-- ロゴとか。。。？ -->
    </div>
    <div class="listItem" value="unk">ユーザネーム</div> <input type="text" id="name"></input>
    <div class="listItem">性別</div> <select type="text" id="gender">
      <option hidden class="hidden"><span class="hidden">選択してください</span></option>
      <option value="m">男性</option>
      <option value="w">女性</option>
      <option value="o">その他</option>
    </select>
    <div class="listItem">年齢</div> <input type="number" id="old"></input>
    <div class="listItem">興味のある分野(3つ以上選択してください)</div>
    <div id="ganre"><tt>
        <input type="checkbox" id="ganreA" name="ganre" class="cb"><label for="ganreA">旅行</label>
        <input type="checkbox" id="ganreB" name="ganre" class="cb"><label for="ganreB">アウトドア</label>
        <input type="checkbox" id="ganreC" name="ganre" class="cb"><label for="ganreC">インドア</label><br>
        <input type="checkbox" id="ganreD" name="ganre" class="cb"><label for="ganreD">スポーツ</label>
        <input type="checkbox" id="ganreE" name="ganre" class="cb"><label for="ganreE">音楽</label>
        <input type="checkbox" id="ganreF" name="ganre" class="cb"><label for="ganreF">演劇</label>
        <input type="checkbox" id="ganreG" name="ganre" class="cb"><label for="ganreG">ダンス</label><br>
        <input type="checkbox" id="ganreH" name="ganre" class="cb"><label for="ganreH">創作</label>
        <input type="checkbox" id="ganreI" name="ganre" class="cb"><label for="ganreI">ゲーム</label>
        <input type="checkbox" id="ganreJ" name="ganre" class="cb"><label for="ganreJ">デジタル系</label>
        <input type="checkbox" id="ganreK" name="ganre" class="cb"><label for="ganreK">飲食</label><br>
        <div class="explolation">
          その他興味のある分野を"ひらがな"で入力してください。<br>
          (複数登録する場合は間に半角のカンマを入力してください。)<br>
          例ぺっと,やきゅう,せいじ<br>
        </div>
        <textarea id="ganref" name="ganre"></textarea>
      </tt> </div>
    <div class="listItem">自己紹介</div>
    <div class="help_area">
      <div class="help_icon">?</div>
      <div class="tooltip"> 自己紹介には、可能な限り日本語で入力してください。<br> その他の言語で入力した場合、マッチングしにくくなる可能性があります。</div>
    </div> <textarea class="cancelEnter" id="free" name="free"></textarea><br>
    <div class="listItem">マッチング後、相手に送るメッセージ</div> <textarea class="cancelEnter" id="message"
      name="message"></textarea><br>
    <!--<div class="listItem">連絡先</div> <label class="url">Instagram</label><input type="text" id="Iid" placeholder="https://instagram.com/yourid"></input><br> <label class="url">Facebook</label><input type="text" id="Fid" placeholder="https://facebook.com/yourid/"></input><br> <label class="url">Twitter</label><input type="text" id="Tid" placeholder="https://twitter.com/yourid/"></input><br><br>-->
    <input type="submit" onclick="pushSaveButton();" value="更新" id="register">
    <div id="foot"><br>:<br>:</div>
    <ul class="bottom-menu">
      <li>
        <!--　↓↓項目1.-->
        <a href="mainPage.html">
          <!--ここに関数を入れる-->
          <!-- home icon --><i class="fa-solid fa-house"></i></br> <span class="mini-text">ホーム</span>
        </a>
      </li>
      <li>
        <!--　↓↓項目2.-->
        <a href="dm.html">
          <!-- chat icon --><i class="fa-solid fa-comment"></i></br> <span class="mini-text">メッセージ</span>
        </a>
      </li>
      <li>
        <!--　↓↓項目3.-->
        <a href="favlist.html">
          <!-- heart icon --><i class="fa-sharp fa-solid fa-heart"></i></br> <span class="mini-text">おきにいり</span>
        </a>
      </li>
      <li class="menu-width-max">
        <!-- ↓↓項目3. -->
        <a href="update.html">
          <!-- profile icon --><i class="fa-solid fa-address-card"></i></br> <span class="mini-text">プロフィール</span>
        </a>
      </li>
    </ul>
  </div>
  <div id="runArea" class="runNoDisp">
    <div class="runWindow">
      <!-- ここがウインドウとなります -->
      <p id="untitti">実行中<br>しばらくお待ちください</p>
      <div class="bar"></div>
    </div>
  </div>

  <script>
    var applicationKey = "";
    var clientKey = "";
    var ncmb = new NCMB(applicationKey, clientKey);
    var currentUser = ncmb.User.getCurrentUser();
    if (currentUser) {
      console.log(currentUser);
      console.log(currentUser.name);
      if (currentUser.name == null) {
        location.href = "profile.html";
      } else {}
    } else {
      alert("ログインに失敗");
      location.href = "login.html";
    }
    if (currentUser) {
      document.getElementById("name").value = currentUser.name;
      document.getElementById("old").value = currentUser.old;
      document.getElementById("message").innerHTML = currentUser.message;
      document.getElementById("free").innerHTML = currentUser.free;
      document.getElementById("gender").value = currentUser.gender;
      let unk = [];
      let ccc = 0;
      unk = ncmb.User.getCurrentUser().ganre;
      if (unk.includes("A")) {
        ganreA.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("B")) {
        ganreB.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("C")) {
        ganreC.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("D")) {
        ganreD.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("E")) {
        ganreE.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("F")) {
        ganreF.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("G")) {
        ganreG.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("H")) {
        ganreH.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("I")) {
        ganreI.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("J")) {
        ganreJ.checked = true;
        unk.pop();
        ccc++;
      } else {}
      if (unk.includes("K")) {
        ganreK.checked = true;
        unk.pop();
        ccc++;
      } else {}
      /*  if (document.getElementById("Iid").value == null) {} else {
        document.getElementById("Iid").value = ncmb.User.getCurrentUser().Iid;
      }
      if (document.getElementById("Fid").value == null) {} else {
        document.getElementById("Fid").value = ncmb.User.getCurrentUser().Fid;
      }
      if (document.getElementById("Tid").value == null) {} else {
        document.getElementById("Tid").value = ncmb.User.getCurrentUser().Tid;
      }
      */
      
      if (unk.length == 0) {} else {
        document.getElementById("ganref").value += unk[0];
        for (var k = 1; k < unk.length; k++) {
          document.getElementById("ganref").value += "," + unk[k];
        }
      }
    } else {
      alert("ログインに失敗");
      window.location.href = "./login.html";
    }
    document.querySelectorAll('.help_icon').forEach(elm => {
      elm.onclick = function () {
        event.stopPropagation();
        let tooltip = this.parentNode.querySelector('.tooltip');
        if (tooltip.style.display == 'block') {
          tooltip.style.display = 'none';
        } else {
          tooltip.style.display = 'block';
        }
      };
    });
    document.body.onclick = function () {
      document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.style.display = 'none';
      });
    };
  </script>
</body>

</html>
